
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Getting Started Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="REGISTERING_COMPONENTS.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2" data-path="GETTING_STARTED.html">
            
                <a href="GETTING_STARTED.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="REGISTERING_COMPONENTS.html">
            
                <a href="REGISTERING_COMPONENTS.html">
            
                    
                    Registering Components
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Getting Started</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="creating-a-simple-rest-api">Creating a simple rest API</h2>
<p>In this tutorial, we will be using inceptum-swagger to create a TODO API that talks to a mysql database. </p>
<h2 id="setting-up-our-app">Setting up our app</h2>
<p>In this tutorial, we&apos;ll be using Typescript, because types are fun. All of this should work in plain javascript as well though!</p>
<p>We&apos;ll be basing our project off <a href="https://github.com/hipages/typescript-base" target="_blank">https://github.com/hipages/typescript-base</a>, this provides a lot of the typescript configs
and dotfiles we&apos;ll need.</p>
<p>For this example, we&apos;ll be just-in-time transpliling it with ts-node. In production we would be pre compiling our code
to javascript, but this will be ok this purposes of this tutorial.</p>
<pre><code>$ yarn global add ts-node
</code></pre><p>Now, lets add inceptum to our project...</p>
<pre><code>$ yarn add inceptum
</code></pre><p>And use it to create our app:</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/index.ts</span>
<span class="hljs-keyword">import</span> { InceptumApp } from <span class="hljs-string">&apos;inceptum&apos;</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> InceptumApp();
app.start();
</code></pre>
<p>If you run <code>ts-node src/index.ts</code> you should see something like below.</p>
<p><img src="images/getting_started/gs1.png" alt="Local Image"></p>
<p>It&apos;s complaining about not having any config, lets fix that!</p>
<h2 id="config">Config</h2>
<p>Lets create a file at <code>/config/default.yml</code></p>
<pre><code class="lang-yml"><span class="hljs-attr">app:</span>
<span class="hljs-attr">  name:</span> My Todo App
<span class="hljs-attr">  context:</span>
<span class="hljs-attr">    name:</span> BaseContext
<span class="hljs-attr">logging:</span>
<span class="hljs-attr">  streams:</span>
<span class="hljs-attr">    console:</span>
<span class="hljs-attr">      type:</span> console
<span class="hljs-attr">    myredis:</span>
<span class="hljs-attr">      type:</span> redis
<span class="hljs-attr">    mainLogFile:</span>
<span class="hljs-attr">      type:</span> file
<span class="hljs-attr">      path:</span> main.log
<span class="hljs-attr">  loggers:</span>
<span class="hljs-attr">    - name:</span> ROOT
<span class="hljs-attr">      streams:</span>
<span class="hljs-attr">        console:</span> debug
</code></pre>
<p> <code>ts-node src/index.ts</code> again... nice! Our app runs, but it doesn&apos;t actually do anything ...yet.</p>
<h2 id="swagger-and-routing">Swagger And Routing</h2>
<p>Setting up the swagger plugin is easy! We just need to import the package and tell our App to use it.
Inceptum Web will set up our express server, and SwaggerPlugin will set up our routing via our swagger file.</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/index.ts</span>
<span class="hljs-keyword">import</span> { InceptumApp, SwaggerPlugin, WebPlugin } from <span class="hljs-string">&apos;inceptum&apos;</span>;
<span class="hljs-keyword">import</span> * as path from <span class="hljs-string">&apos;path&apos;</span>;

<span class="hljs-keyword">const</span> swaggerPath = path.resolve(<span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/../config/swagger.yaml`</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> InceptumApp();
app.use(<span class="hljs-keyword">new</span> WebPlugin(), <span class="hljs-keyword">new</span> SwaggerPlugin(swaggerPath))
app.start();
</code></pre>
<p>We now need to set up our swagger file where we will define our routes. This seems pretty long, but most of it is just 
boilerplate </p>
<pre><code class="lang-yml"><span class="hljs-comment"># /config/swagger.yaml</span>
<span class="hljs-attr">swagger:</span> <span class="hljs-string">&quot;2.0&quot;</span>
<span class="hljs-attr">info:</span>
<span class="hljs-attr">  version:</span> <span class="hljs-string">&quot;0.0.1&quot;</span>
<span class="hljs-attr">  title:</span> ToDo sample application
<span class="hljs-attr">host:</span> localhost:<span class="hljs-number">10010</span>
<span class="hljs-attr">basePath:</span> /
<span class="hljs-attr">schemes:</span>
<span class="hljs-bullet">  -</span> http
<span class="hljs-bullet">  -</span> https 
<span class="hljs-attr">consumes:</span>
<span class="hljs-bullet">  -</span> application/json
<span class="hljs-attr">produces:</span>
<span class="hljs-bullet">  -</span> application/json
<span class="hljs-attr">paths:</span>
  /todo/{id}:
<span class="hljs-attr">    x-inceptum-controller:</span> TodoController
<span class="hljs-attr">    get:</span>
<span class="hljs-attr">      description:</span> Gets one todo by id
<span class="hljs-attr">      x-inceptum-operation:</span> get(id)
<span class="hljs-attr">      parameters:</span>
<span class="hljs-attr">       - name:</span> id
<span class="hljs-attr">         type:</span> string
<span class="hljs-attr">         required:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">         in:</span> path
<span class="hljs-attr">      responses:</span>
        <span class="hljs-string">&quot;200&quot;</span>:
<span class="hljs-attr">          description:</span> Success
<span class="hljs-attr">          schema:</span>
<span class="hljs-attr">            type:</span> object
</code></pre>
<p>The intersting parts here are the custom attributes we&apos;ve defind <code>x-inceptum-controller</code> and <code>x-inceptum-operation</code>.
The attributes are basically defining what method we are going to call on what controller, as well as what paramaters
we are going to pass to that method.</p>
<p>Finally, we need to let inceptum know where to find out controllers. To do this, we can add the following line to our
index.js.</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/index.ts</span>
<span class="hljs-keyword">import</span> { InceptumApp, SwaggerPlugin, WebPlugin } from <span class="hljs-string">&apos;inceptum&apos;</span>;
<span class="hljs-keyword">import</span> * as path from <span class="hljs-string">&apos;path&apos;</span>;

<span class="hljs-keyword">const</span> swaggerPath = path.resolve(<span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/../config/swagger.yaml`</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> InceptumApp();
app.addDirectory(path.resolve(<span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/controller`</span>));  <span class="hljs-comment">// &lt;--- Register our controllers</span>
app.use(<span class="hljs-keyword">new</span> WebPlugin(), <span class="hljs-keyword">new</span> SwaggerPlugin(swaggerPath));
app.start();
</code></pre>
<p>Here we are using node&apos;s built-in <code>path</code> module to point inceptum to our controllers located at <code>/src/controllers</code></p>
<p>We can now write our controller!</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/controller/TodoController.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> TodoController {

  async <span class="hljs-keyword">get</span>(id, req, res) {
    <span class="hljs-keyword">return</span> res.send({
      id: id,
      done: <span class="hljs-literal">false</span>
    });
  }

}
</code></pre>
<p>Now, if you start your app and go to <a href="http://localhost:10010/todo/1234" target="_blank"><code>http://localhost:10010/todo/1234</code></a> in your browser you should receive the following JSON response:</p>
<pre><code class="lang-json">{
  &quot;id&quot;: 1234,
  &quot;done: false
}
</code></pre>
<p>Cool! But static data isn&apos;t really useful. Lets add a database!</p>
<h2 id="adding-a-database">Adding a database</h2>
<p>To add a database connection to our app, all we need to do is add the following to our config.yml. Inceptum will automatically 
create a <code>MysqlPlugin()</code> (// TODO LINK) to our application. It will be registered under the name <code>MainMysqlClient</code> to the IoC container.</p>
<pre><code class="lang-yml"><span class="hljs-comment">#config/default.yml</span>
<span class="hljs-comment"># ... other configs</span>
<span class="hljs-attr">mysql:</span> <span class="hljs-comment"># Telling inceptum to add a new MysqlPlugin() to our app</span>
<span class="hljs-attr">  MainMysqlClient:</span> <span class="hljs-comment"># IoC name</span>
<span class="hljs-attr">    master:</span>
<span class="hljs-attr">      host:</span> localhost
<span class="hljs-attr">      port:</span> <span class="hljs-number">3306</span>
<span class="hljs-attr">      user:</span> root
<span class="hljs-attr">      password:</span>
<span class="hljs-attr">      database:</span> testDb
<span class="hljs-attr">      charset:</span> utf8
<span class="hljs-attr">      connectionLimit:</span> <span class="hljs-number">10</span>
</code></pre>
<p>You&apos;ll notice that we&apos;ve added a <code>master</code> conifg. We can also add a <code>slave</code> config that Inceptum will use if we want a read only
transaction, like so:</p>
<pre><code class="lang-yml"><span class="hljs-comment">#config/default.yml</span>
<span class="hljs-comment"># ... other configs</span>
<span class="hljs-attr">mysql:</span>
<span class="hljs-attr">  MainMysqlClient:</span> <span class="hljs-comment"># this is the name of the object that will be exposed in the context</span>
<span class="hljs-attr">    master:</span>
<span class="hljs-attr">      host:</span> localhost
<span class="hljs-attr">      port:</span> <span class="hljs-number">3306</span>
<span class="hljs-attr">      user:</span> root
<span class="hljs-attr">      password:</span>
<span class="hljs-attr">      database:</span> testDb
<span class="hljs-attr">      charset:</span> utf8
<span class="hljs-attr">      connectionLimit:</span> <span class="hljs-number">10</span>
<span class="hljs-attr">    slave:</span>
<span class="hljs-attr">      host:</span> localhost
<span class="hljs-attr">      port:</span> <span class="hljs-number">3306</span>
<span class="hljs-attr">      user:</span> root
<span class="hljs-attr">      password:</span>
<span class="hljs-attr">      database:</span> testDb
<span class="hljs-attr">      charset:</span> utf8
<span class="hljs-attr">      connectionLimit:</span> <span class="hljs-number">10</span>
</code></pre>
<p>Feel free to edit the mysql config use a valid username/password so it can connect on your local.
In this example both connections are pointing to the same place, but in production we can change this to point to a read only replica or user.</p>
<h2 id="connecting-everything-together">Connecting everything together</h2>
<p>To talk to our database, we&apos;re going to create a <code>Service</code> class.</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/service/TodoService.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> TodoService {

  getTodo(id) {
    <span class="hljs-comment">// TODO Implement me!</span>
  }

}
</code></pre>
<p>Here, we&apos;re going to tell inceptum that we want access to the mysql client we just set up in the service we just created.
To do this, we define a static property on our class to tell inceptum what dependencies we want to be injected.</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/service/TodoService.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> TodoService {

  <span class="hljs-keyword">static</span> autowire = {
    mysql: <span class="hljs-string">&apos;MainMysqlClient&apos;</span>,
  };

  getTodo(id) {
    <span class="hljs-comment">// TODO Implement me!</span>
  }
}
</code></pre>
<p>We can now use the client in our service like below:</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/service/TodoService.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> TodoService {
  mysql: <span class="hljs-built_in">any</span>;

  <span class="hljs-keyword">static</span> autowire = {
    mysql: <span class="hljs-string">&apos;MainMysqlClient&apos;</span>,
  };

  async getTodo(id) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.mysql.runInTransaction(<span class="hljs-literal">true</span>, async (client) =&gt; {
      <span class="hljs-keyword">const</span> [todo] = await client.query(<span class="hljs-string">`SELECT * FROM todos WHERE id = ?`</span>, id);
      <span class="hljs-keyword">return</span> todo;
    });
  }
}
</code></pre>
<p>Finally, we need to tell Inceptum that these service classes exist:</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/index.ts</span>
<span class="hljs-keyword">import</span> { InceptumApp, SwaggerPlugin, WebPlugin } from <span class="hljs-string">&apos;inceptum&apos;</span>;
<span class="hljs-keyword">import</span> * as path from <span class="hljs-string">&apos;path&apos;</span>;

<span class="hljs-keyword">const</span> swaggerPath = path.resolve(<span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/../config/swagger.yaml`</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> InceptumApp();
app.addDirectory(path.resolve(<span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/controller`</span>));
app.addDirectory(path.resolve(<span class="hljs-string">`<span class="hljs-subst">${__dirname}</span>/service`</span>)); <span class="hljs-comment">// &lt;--- Register our services</span>
app.use(<span class="hljs-keyword">new</span> WebPlugin(), <span class="hljs-keyword">new</span> SwaggerPlugin(swaggerPath));
app.start();
</code></pre>
<p>Now, we need to wire up our service to our controller, we do this in a similar way to mysql</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// src/controller/TodoController.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> TodoController {
  service: <span class="hljs-built_in">any</span>;

  <span class="hljs-keyword">static</span> autowire = {
    service: <span class="hljs-string">&apos;TodoService&apos;</span>,
  };

  async <span class="hljs-keyword">get</span>(id, req, res) {
    <span class="hljs-keyword">const</span> todo = await <span class="hljs-keyword">this</span>.service.getTodo(id);
    res.send(todo);
  }
}
</code></pre>
<p>Finally, lets let up our database table so we can query it live, run this SQL on your local mysql server:</p>
<pre><code>CREATE DATABASE testdb;
USE testdb;
CREATE TABLE `todos` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `done` bool DEFAULT false,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

INSERT INTO todos VALUES(&apos;1234&apos;,true);
</code></pre><p>If we hit <a href="http://localhost:10010/todo/1234" target="_blank"><code>http://localhost:10010/todo/1234</code></a> now, you should see data straight out of your database in JSON form. </p>
<pre><code class="lang-json">{
  &quot;id&quot;: 1234,
  &quot;done: true
}
</code></pre>
<p>Congrats! You have just created
your first REST API powered by Inceptum!</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Introduction">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="REGISTERING_COMPONENTS.html" class="navigation navigation-next " aria-label="Next page: Registering Components">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Getting Started","level":"1.2","depth":1,"next":{"title":"Registering Components","level":"1.3","depth":1,"path":"REGISTERING_COMPONENTS.md","ref":"REGISTERING_COMPONENTS.md","articles":[]},"previous":{"title":"Introduction","level":"1.1","depth":1,"path":"README.md","ref":"README.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"GETTING_STARTED.md","mtime":"2018-04-19T12:40:04.369Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-05-03T22:09:08.300Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

