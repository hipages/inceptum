
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Writing Plugins Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="REGISTERING_COMPONENTS.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="GETTING_STARTED.html">
            
                <a href="GETTING_STARTED.html">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="REGISTERING_COMPONENTS.html">
            
                <a href="REGISTERING_COMPONENTS.html">
            
                    
                    Registering Components
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="WRITING_PLUGINS.html">
            
                <a href="WRITING_PLUGINS.html">
            
                    
                    Writing Plugins
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Writing Plugins</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="plugins">Plugins</h1>
<p>Inceptum does nothing on its own. Almost everything is done using either using internal plugins of 
by user made custom plugins. </p>
<h2 id="writing-your-first-plugin">Writing your first Plugin</h2>
<p>In this guide, we will explore how we can implement a plugin by our selves.</p>
<p>For this example, we will implement a fake logger based on the <code>console</code>.
In the real world, you will most likely use a proper logger like Winston or
Bunyan. We do this here only for introducing the concept of Inceptum Plugins. 
We will create two classes, one for doing the actual logging operations and
the other for registering the plugin with Inceptum. </p>
<p>An inceptum plugin can do a lot of things, but for this example, we will
stick with the bare minimum. </p>
<h3 id="the-console-logger">The Console Logger</h3>
<p>Let&apos;s see what we want to do here. The logger would have 4 methods, </p>
<ul>
<li><code>debug</code></li>
<li><code>info</code></li>
<li><code>warn</code></li>
<li><code>error</code></li>
</ul>
<p>We will disable certain types of logs based on the initial log-level configuration.
For example, if the log-level is set to <code>warn</code>, the logger will spit out warnings and 
errors only, while silently swallowing debug and info logs.</p>
<h4 id="step-1-write-the-client">Step 1: Write the client</h4>
<p>The client code is pretty simple. Let&apos;s call our logger, <code>ConsoLogger</code></p>
<pre><code class="lang-js"><span class="hljs-comment">// ConsoLogger.js</span>
<span class="hljs-keyword">const</span> loglevelMap = {
  debug: [<span class="hljs-string">&apos;debug&apos;</span>, <span class="hljs-string">&apos;info&apos;</span>, <span class="hljs-string">&apos;warn&apos;</span>, <span class="hljs-string">&apos;error&apos;</span>],
  info: [<span class="hljs-string">&apos;info&apos;</span>, <span class="hljs-string">&apos;warn&apos;</span>, <span class="hljs-string">&apos;error&apos;</span>],
  warn: [<span class="hljs-string">&apos;warn&apos;</span>, <span class="hljs-string">&apos;error&apos;</span>],
  error: [<span class="hljs-string">&apos;error&apos;</span>],
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsoLogger</span> </span>{
  <span class="hljs-keyword">constructor</span>(config) {
    <span class="hljs-comment">// The corresponding logger config should define a property called `loglevel`</span>
    <span class="hljs-keyword">this</span>.loglevel = config.loglevel
  }

  debug(message) {
    <span class="hljs-keyword">this</span>.printLog(<span class="hljs-string">&apos;debug&apos;</span>, message);
  }

  info(message) {
    <span class="hljs-keyword">this</span>.printLog(<span class="hljs-string">&apos;info&apos;</span>, message);
  }

  warn(message) {
    <span class="hljs-keyword">this</span>.printLog(<span class="hljs-string">&apos;warn&apos;</span>, message);
  }

  error(message) {
    <span class="hljs-keyword">this</span>.printLog(<span class="hljs-string">&apos;error&apos;</span>, message);
  }

  printLog(type, message) {
    <span class="hljs-comment">// Given the log type, if the loglevel map includes the corresponding type,</span>
    <span class="hljs-comment">// then we print the log, else just ignore</span>
    <span class="hljs-keyword">if</span> (loglevelMap[<span class="hljs-keyword">this</span>.loglevel].includes(type)) {
      <span class="hljs-built_in">console</span>[type](message); <span class="hljs-comment">// This calls console.info, console.warn, ... respectively</span>
    }
  }
}
</code></pre>
<h4 id="step-2-writing-the-plugin">Step 2: Writing the Plugin</h4>
<p>The plugin should do 2 basic things,</p>
<ol>
<li>Read the logger config from the <code>yaml</code> config file</li>
<li>Register the <code>ConsoLogger</code> in the inceptum Context</li>
</ol>
<p>Once this is done and the Plugin is provided in the app, it can be used from any inceptum module
in the app. </p>
<p>Now let&apos;s start writing the plugin. A plugin must have a <code>name</code> property, and can implement
one or both of <code>willStart</code> and <code>didStart</code> life-cycle hooks. The willStart hook will run before 
the Inceptum App starts, and the DidStart hook will run after the App starts. 
You will most likely use the <code>willStart</code> hook to initialize a client or a service
similar to this very example.</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// ConsoLoggerPlugin.ts</span>
<span class="hljs-keyword">import</span> { BaseApp, Plugin, BaseSingletonDefinition } from <span class="hljs-string">&apos;inceptum&apos;</span>;
<span class="hljs-keyword">import</span> ConsoLogger from <span class="hljs-string">&apos;./ConsoLogger&apos;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> ConsoLoggerPlugin <span class="hljs-keyword">implements</span> Plugin {
  name = <span class="hljs-string">&apos;ConsoLoggerPlugin&apos;</span>;

  willStart(app: BaseApp) {
    <span class="hljs-comment">// This means that we will read a config with name `logger` from the config yaml files</span>
    <span class="hljs-keyword">if</span> (!app.hasConfig(<span class="hljs-string">&apos;logger&apos;</span>)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;Failed to find logger configs&apos;</span>);
    }

    <span class="hljs-comment">// Get the inceptum app context</span>
    <span class="hljs-keyword">const</span> context = app.getContext();

    <span class="hljs-comment">// Read the logger config</span>
    <span class="hljs-keyword">const</span> config = context.getConfig(<span class="hljs-string">&apos;logger&apos;</span>);

    <span class="hljs-comment">// Create the `ConsoLogger` client definition</span>
    <span class="hljs-comment">// The name given here, (i.e. &apos;ConsoLogger&apos;) will be used to get the client from the actual app</span>
    <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> BaseSingletonDefinition(ConsoLogger, <span class="hljs-string">&apos;MyConsoLogger&apos;</span>);

    <span class="hljs-comment">// Declare that the logger config we read above will be passed to the client constructor</span>
    client.constructorParamByValue(config);

    <span class="hljs-comment">// Register the logger client in the inceptum app context</span>
    context.registerSingletons(client);
  }
}
</code></pre>
<p>Cool, we&apos;ve written our plugin. Now let&apos;s use it in our app. </p>
<h4 id="step-3-define-the-logger-configuration">Step 3: Define the logger configuration</h4>
<p>Similar to how we defined the mysql configs in the Getting Started guide,
we need to provide the logger config as well. We only need to provide the
log-level for this example. Let&apos;s add the following entry to the <code>default.yaml</code> file,</p>
<pre><code class="lang-yaml"><span class="hljs-attr">logger:</span>
<span class="hljs-attr">  loglevel:</span> warn
</code></pre>
<h4 id="step-4-use-the-logger-client">Step 4. Use the logger client</h4>
<pre><code class="lang-typescript"><span class="hljs-comment">// index.ts</span>
<span class="hljs-keyword">import</span> { InceptumApp, WebPlugin } from <span class="hljs-string">&apos;inceptum&apos;</span>;
<span class="hljs-keyword">import</span> ConsoLoggerPlugin from <span class="hljs-string">&apos;./ConsoLoggerPlugin&apos;</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> InceptumApp();

app.use(
  <span class="hljs-keyword">new</span> WebPlugin(),
  <span class="hljs-keyword">new</span> ConsoLoggerPlugin()
);

app.start()
</code></pre>
<p>Now we can use this from any inceptum module in our app. Let&apos;s use it in a service,</p>
<pre><code class="lang-typescript"><span class="hljs-comment">// AccountService.ts</span>
<span class="hljs-keyword">import</span> { Autowire } from <span class="hljs-string">&apos;inceptum&apos;</span>;
<span class="hljs-keyword">import</span> ConsoLogger from <span class="hljs-string">&apos;../ConsoLogger&apos;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> AccountService {
  <span class="hljs-comment">// Here we Autowire the ConsoLogger client</span>
  <span class="hljs-comment">// based on the name we provided in the Plugin</span>
  @Autowire(<span class="hljs-string">&apos;MyConsoLogger&apos;</span>) logger: ConsoLogger;

  createAccount() {
    <span class="hljs-keyword">this</span>.logger.error(<span class="hljs-string">&quot;Something went wrong!&quot;</span>); <span class="hljs-comment">// This will output &apos;Something went wrong!&apos;</span>
    <span class="hljs-keyword">this</span>.logger.info(<span class="hljs-string">&quot;Less important info&quot;</span>); <span class="hljs-comment">// This will not output anything, since we set the log-level to `warn`</span>
  }
}
</code></pre>
<p>That&apos;s it for this guide. Merry Inceptum!</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="REGISTERING_COMPONENTS.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Registering Components">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Writing Plugins","level":"1.4","depth":1,"previous":{"title":"Registering Components","level":"1.3","depth":1,"path":"REGISTERING_COMPONENTS.md","ref":"REGISTERING_COMPONENTS.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"WRITING_PLUGINS.md","mtime":"2019-06-03T05:09:46.761Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-10-02T05:04:36.259Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

